<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generate Band V2 - Test Interface</title>
  <link rel="stylesheet" href="https://unpkg.com/@appwrite.io/pink@0" />
  <link rel="stylesheet" href="https://unpkg.com/@appwrite.io/pink-icons@0" />
  <script src="//unpkg.com/alpinejs" defer></script>
</head>
<body class="theme-dark">
  <main class="main-content">
    <div class="top-cover u-padding-block-end-56">
      <div class="container">
        <h1 class="heading-level-1 u-margin-block-start-16">Generate Band Function V2</h1>
        <p class="body-text-1 u-normal u-margin-block-start-8" style="max-width: 50rem">
          Use this interface to test the band generation function. Enter a creative prompt
          and the function will generate a complete band profile with AI.
        </p>
      </div>
    </div>
    
    <div x-data="bandGenerator()" class="container u-margin-block-start-negative-56">
      <div class="card u-flex u-gap-24 u-flex-vertical">
        <div>
          <h2 class="heading-level-4">Create a Band</h2>
          <p class="text u-margin-block-start-8">
            Describe the type of band you want to create. Be creative!
          </p>
          
          <div class="u-margin-block-start-16">
            <label class="label">Band Concept</label>
            <textarea 
              x-model="prompt"
              class="input-text"
              rows="4"
              placeholder="Example: Create a synthwave band inspired by 80s sci-fi movies and Japanese city pop..."
              :disabled="isGenerating"
            ></textarea>
          </div>
          
          <div class="u-margin-block-start-16">
            <label class="label">User ID (optional)</label>
            <input 
              x-model="userId"
              type="text"
              class="input-text"
              placeholder="Leave empty for anonymous"
              :disabled="isGenerating"
            />
          </div>
          
          <button 
            @click="generateBand()"
            class="button u-margin-block-start-16"
            :disabled="!prompt || isGenerating"
          >
            <span class="text" x-text="isGenerating ? 'Generating...' : 'Generate Band'"></span>
          </button>
          
          <template x-if="error">
            <div class="alert is-danger u-margin-block-start-16">
              <div class="alert-grid">
                <span class="icon-x-circle" aria-hidden="true"></span>
                <div class="alert-content">
                  <h6 class="alert-title">Error</h6>
                  <p class="alert-message" x-text="error"></p>
                </div>
              </div>
            </div>
          </template>
          
          <template x-if="result">
            <div class="u-margin-block-start-24">
              <h3 class="heading-level-5">Generation Result</h3>
              <div class="card u-margin-block-start-8" style="background: #1a1a1a;">
                <pre class="u-text-wrap" style="color: #e0e0e0; font-size: 0.875rem;"><code x-text="JSON.stringify(result, null, 2)"></code></pre>
              </div>
              <p class="text u-margin-block-start-8">
                Band ID: <code class="inline-code" x-text="result.bandId"></code>
              </p>
              <p class="text u-margin-block-start-4">
                Check your Appwrite console to see the created band, album, and songs!
              </p>
            </div>
          </template>
        </div>
        
        <div class="u-sep-block"></div>
        
        <div>
          <h3 class="heading-level-5">API Usage</h3>
          <p class="text u-margin-block-start-8">
            Send a POST request to this function with the following JSON body:
          </p>
          <div class="code-block u-margin-block-start-8">
            <pre>{
  "prompt": "Your band concept here",
  "userId": "optional-user-id"
}</pre>
          </div>
          
          <h4 class="heading-level-6 u-margin-block-start-16">Response</h4>
          <div class="code-block u-margin-block-start-8">
            <pre>{
  "success": true,
  "bandId": "generated-band-id",
  "bandName": "Band Name",
  "albumId": "album-id",
  "albumTitle": "Album Title",
  "songCount": 12,
  "visualAssets": {
    "logoUrl": "...",
    "albumCoverUrl": "...",
    "bandPhotoUrl": "..."
  },
  "message": "Band generation completed successfully"
}</pre>
          </div>
          
          <h4 class="heading-level-6 u-margin-block-start-16">Environment Variables</h4>
          <ul class="list u-margin-block-start-8">
            <li>ANTHROPIC_API_KEY - Required for AI generation</li>
            <li>FAL_API_KEY - Optional for image generation</li>
            <li>APPWRITE_FUNCTION_API_KEY - Required for database access</li>
          </ul>
        </div>
      </div>
    </div>
  </main>
  
  <script>
    function bandGenerator() {
      return {
        prompt: '',
        userId: '',
        isGenerating: false,
        result: null,
        error: null,
        
        async generateBand() {
          this.isGenerating = true;
          this.error = null;
          this.result = null;
          
          try {
            const response = await fetch('/', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                prompt: this.prompt,
                userId: this.userId || undefined
              })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.success) {
              throw new Error(data.error || 'Generation failed');
            }
            
            this.result = data;
          } catch (err) {
            this.error = err.message;
          } finally {
            this.isGenerating = false;
          }
        }
      };
    }
  </script>
</body>
</html>